<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="keywords"
      content="quick pdf merge, merge pdfs online, pdf combiner, merge pdf files, combine pdf documents"
    />
    <meta
      name="description"
      content="Quick PDF Merge is a fast and easy-to-use online tool for merging PDF files. Combine multiple PDFs into one document quickly and hassle-free. No installation or sign-up required."
    />
    <title>Merge PDFs Online - Fast and Easy PDF Combiner</title>

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    />
    <style>
      body {
        font-family: "Roboto", sans-serif;
        background-color: #282c34;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Prevent scrolling on the body */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }
      .container {
        text-align: center;
        background: #ffffff;
        padding: 40px;
        padding-left: 80px;
        padding-right: 80px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        max-width: calc(100vw - 80px);
      }
      h1 {
        color: #212121;
        font-size: 36px;
        margin-bottom: 20px;
      }
      p {
        color: #757575;
        font-size: 18px;
        margin-bottom: 30px;
      }
      #uploadButton {
        display: inline-block;
        padding: 15px 30px;
        font-size: 18px;
        text-align: center;
        color: #fff;
        background-color: #3f51b5;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        outline: none;
        border: 2px solid transparent;
      }
      #uploadButton:hover {
        background-color: #303f9f;
      }
      #fileInput {
        display: none;
      }
      #thumbnailContainer {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 20px;
        justify-content: center;
        max-height: calc(
          100vh - 450px
        ); /* Set maximum height relative to viewport height */
        overflow-y: auto; /* Add vertical scrolling */
      }
      .thumbnail {
        width: 100px;
        height: 140px;
        border: 1px solid #ddd;
        cursor: pointer;
        position: relative;
        transition: transform 0.3s, z-index 0.3s;
      }
      .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .thumbnail .page-index {
        position: absolute;
        top: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        padding: 2px 5px;
        font-size: 12px;
      }
      .thumbnail.expanded {
        transform: scale(3);
        z-index: 10;
      }
      #downloadButton {
        display: none;
        padding: 15px 30px;
        font-size: 18px;
        text-align: center;
        color: #fff;
        background-color: #3f51b5;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        outline: none;
        border: 2px solid transparent;
        margin-top: 20px;
      }
      #downloadButton:hover {
        background-color: #303f9f;
      }

      /* Modal styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8);
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        position: relative;
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        max-width: 90%;
        max-height: 90vh; /* Set maximum height relative to viewport height */
        overflow: auto; /* Add overflow auto to enable scrolling if necessary */
        box-sizing: border-box; /* Ensure padding and border are included in max dimensions */
      }
      .close {
        position: absolute;
        top: 10px;
        right: 25px;
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
      }
      .close:hover,
      .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
      }

      .remove-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        width: 24px;
        height: 24px;
        background-color: transparent;
        border: none;
        cursor: pointer;
        font-size: 24px;
        color: rgba(0, 0, 0, 0.54); /* Default icon color */
      }

      .remove-btn:hover {
        color: rgba(0, 0, 0, 0.87); /* Icon color on hover */
      }
    </style>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-19QHLYK4ZS"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-19QHLYK4ZS");
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Merge PDFs Online</h1>
      <p>Fast and Easy PDF Combiner</p>
      <button id="uploadButton">Select PDF Files</button>
      <input type="file" id="fileInput" multiple accept="application/pdf" />
      <div id="thumbnailContainer"></div>
      <button id="downloadButton">Download Merged PDF</button>
      <p>
        Don't worry, we don't keep any of your files. Everything stays safe on
        your own device.
      </p>
    </div>

    <!-- Modal for displaying larger thumbnails -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <img id="modalImage" src="" alt="PDF Page" style="width: 100%" />
      </div>
    </div>

    <script src="https://unpkg.com/pdf-lib@latest/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist/build/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist/build/pdf.worker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script>
      const { PDFDocument } = PDFLib;
      const pdfjsLib = window["pdfjs-dist/build/pdf"];

      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdn.jsdelivr.net/npm/pdfjs-dist/build/pdf.worker.min.js";

      document.getElementById("uploadButton").addEventListener("click", () => {
        document.getElementById("fileInput").click();
      });

      document
        .getElementById("fileInput")
        .addEventListener("change", async (event) => {
          const files = event.target.files;
          if (files.length === 0) {
            alert("No files selected");
            return;
          }

          const thumbnailContainer =
            document.getElementById("thumbnailContainer");
          //   thumbnailContainer.innerHTML = "";

          const pdfArrayBuffers = [];

          for (const file of files) {
            const arrayBuffer = await file.arrayBuffer();
            pdfArrayBuffers.push(arrayBuffer);

            const pdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;
            const numPages = pdfDoc.numPages;

            for (let i = 0; i < numPages; i++) {
              const page = await pdfDoc.getPage(i + 1);
              const viewport = page.getViewport({ scale: 0.25 });
              const canvas = document.createElement("canvas");
              const context = canvas.getContext("2d");
              canvas.width = viewport.width;
              canvas.height = viewport.height;

              await page.render({ canvasContext: context, viewport }).promise;

              const thumbnailElement = document.createElement("div");
              thumbnailElement.className = "thumbnail";
              thumbnailElement.dataset.pageIndex = i;
              thumbnailElement.dataset.fileIndex = pdfArrayBuffers.length - 1;
              const img = document.createElement("img");
              img.src = canvas.toDataURL();

              // Create the "X" button
              // Create the "X" button as a Material UI icon button
              const removeButton = document.createElement("button");
              removeButton.className = "remove-btn material-icons";
              removeButton.textContent = "close"; // Use Material UI close icon
              thumbnailElement.appendChild(removeButton);

              // Add event listener to remove button
              removeButton.addEventListener("click", (e) => {
                e.stopPropagation();
                thumbnailElement.remove(); // Remove the thumbnail element
                if (thumbnailContainer.childNodes.length === 0) {
                  document.getElementById("downloadButton").style.display =
                    "none";
                }
              });

              thumbnailElement.appendChild(img);
              thumbnailContainer.appendChild(thumbnailElement);

              // Add click event listener to show larger image in modal
              thumbnailElement.addEventListener("click", async () => {
                const modal = document.getElementById("modal");
                const modalImage = document.getElementById("modalImage");

                // Get the file index and page index from the thumbnail element
                const fileIndex = thumbnailElement.dataset.fileIndex;
                const pageIndex = thumbnailElement.dataset.pageIndex;

                // Load the corresponding PDF document
                const arrayBuffer = await files[fileIndex].arrayBuffer();
                const pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer })
                  .promise;

                // Get the page
                const page = await pdfDoc.getPage(Number(pageIndex) + 1);

                // Render the page at a higher scale for better resolution
                const scale = 2; // Adjust the scale as needed
                const viewport = page.getViewport({ scale });
                const canvas = document.createElement("canvas");
                const context = canvas.getContext("2d");
                canvas.width = viewport.width;
                canvas.height = viewport.height;

                const renderContext = {
                  canvasContext: context,
                  viewport: viewport,
                };

                await page.render(renderContext).promise;

                // Update the modal image source with the rendered canvas
                modalImage.src = canvas.toDataURL();
                modal.style.display = "flex";
              });
            }
          }

          document.getElementById("downloadButton").style.display =
            "inline-block";

          // Make the thumbnails sortable
          new Sortable(thumbnailContainer, {
            animation: 150,
          });
        });

      document
        .getElementById("downloadButton")
        .addEventListener("click", async () => {
          const thumbnailContainer =
            document.getElementById("thumbnailContainer");
          const thumbnails = Array.from(thumbnailContainer.children);
          const files = document.getElementById("fileInput").files;

          const mergedPdf = await PDFDocument.create();

          for (const thumbnail of thumbnails) {
            const fileIndex = thumbnail.dataset.fileIndex;
            const pageIndex = thumbnail.dataset.pageIndex;

            const arrayBuffer = await files[fileIndex].arrayBuffer();
            const pdfDoc = await PDFDocument.load(arrayBuffer);
            const [page] = await mergedPdf.copyPages(pdfDoc, [
              Number(pageIndex),
            ]);
            mergedPdf.addPage(page);
          }

          const mergedPdfBytes = await mergedPdf.save();
          const blob = new Blob([mergedPdfBytes], { type: "application/pdf" });
          const url = URL.createObjectURL(blob);

          const downloadLink = document.createElement("a");
          downloadLink.href = url;
          downloadLink.download = "merged.pdf";
          downloadLink.click();

          // Clear the state after download
          clearState();
        });

      // Close modal when close button is clicked
      document.querySelector(".modal .close").addEventListener("click", () => {
        document.getElementById("modal").style.display = "none";
      });

      // Close modal when clicking outside the modal content
      window.addEventListener("click", (event) => {
        const modal = document.getElementById("modal");
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });

      function clearState() {
        document.getElementById("fileInput").value = "";
        document.getElementById("thumbnailContainer").innerHTML = "";
        document.getElementById("downloadButton").style.display = "none";
      }
    </script>
  </body>
</html>
